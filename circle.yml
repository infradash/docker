## Circle CI configuration
general:
  branches:
    ignore:
      - master
      - gh-pages

machine:
  services:
    - docker

  timezone:
    America/Los_Angeles

  # Override /etc/hosts
  hosts:
    circlehost: 127.0.0.1

  # Add some environment variables
  environment:

## Customize dependencies
dependencies:
  pre:
    - ./env.sh make pre-image-build
    
    # Get Dasher
    - ./env.sh make get-dasher

    # Start SSH Tunnel
    - ./env.sh make start-tunnel

    # Set up Docker login
    - ./env.sh make docker-login
    
    # Begin release
    - ./env.sh make begin-release

  override:

    # Build the Docker image
    - BASE=$PWD ./env.sh cd $BUILD_DIR && $BASE/env.sh make push

  post:

    # Commit the change to Registry
    - ./env.sh make commit-release

test:
  override:
    - echo "No tests."

